{% extends 'base.html' %} {% block content %}
<body class="bg-gray-100">
  <h2 id="room-code-display">Room Code: <span>{{room}}</span>{{user}}</h2>
  <script type="text/javascript">
      var socketio = io.connect();
      socketio.on("message", 
      function (message) {
         createChatItem(message.message, message.sender) 
        });
      function createChatItem(message, sender) {
        var messages = document.getElementById("messages");
        if (sender === "") {
          content = `<p>${message}</p>`;
        } else {
          var senderIsUser = "{{user}}" === sender;
          if (senderIsUser) {
            var content = 
          `
            <div class="flex justify-end">
              <div class="bg-blue-500 text-white rounded-lg py-2 px-4 max-w-xs">
                  ${message}
              </div>
            </div>
          `   
          }else{
            var content = 
            `
              <div class="flex justify-start">
                      <div class="bg-gray-300 rounded-lg py-2 px-4 max-w-xs">
                         ${message}
                      </div>
                  </div>
            `
          }
      
      }
        messages.innerHTML += content;
      }
      function sendMessage() {
        var msgInput = document.getElementById("message-input");
        if (msgInput.value === "") return;
        var msg = msgInput.value;
        socketio.emit("message", { message: msg });
        msgInput.value = "";
      }
    </script>
    
  <div class="flex h-screen">
      <!-- Sidebar -->
      <div class="w-full sm:w-64 bg-white border-r border-gray-200 flex flex-col">
          <!-- Search bar -->
          <div class="p-4">
              <input type="text" placeholder="Search friends..." class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <!-- Friend list -->
          <div class="flex-1 overflow-y-auto">
            {% for chat in chats%}
              <div class="p-4 hover:bg-gray-100 cursor-pointer">
                {% if current_user.id == chat.member_1 %}
                  <h3 class="font-semibold">{{chat.member_2}} </h3>
                {% else %}
                <h3 class="font-semibold">{{chat.member_1}} </h3>
                {% endif %} 
                  <p class="text-sm text-gray-500">Last message...</p>
              </div>
              {% endfor %}  
              <!-- <div class="p-4 hover:bg-gray-100 cursor-pointer">
                  <h3 class="font-semibold">Jane Smith</h3>
                  <p class="text-sm text-gray-500">Last message...</p>
              </div>
              <div class="p-4 hover:bg-gray-100 cursor-pointer">
                  <h3 class="font-semibold">Bob Johnson</h3>
                  <p class="text-sm text-gray-500">Last message...</p>
              </div> -->
              <!-- Add more friend items here -->
          </div>
      </div>

      <!-- Main chat area -->
      <div class="flex-1 flex flex-col">
          <!-- Chat header -->
          <div class="bg-white border-b border-gray-200 p-4">
              <h2 class="text-xl font-semibold">Chat with John Doe</h2>
          </div>
          <!-- Message list -->
          <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-4">
              {% for message in messages %}
                  <script type="text/javascript">
                      createChatItem("{{message.message}}", "{{message.sender}}");
                  </script>
                  {% endfor %} 
              <!-- Add more messages here-->
          </div>
          <!-- Message input -->
          <div class="bg-white border-t border-gray-200 p-4">
              <div class="flex space-x-2">
                  <input type="text" id="message-input" placeholder="Type a message..." class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Send</button>
              </div>
          </div>
      </div>
  </div>
</body>
{% endblock %}